|         title         |    date    |          tags          |
| :-------------------: | :--------: | :--------------------: |
| 图解HTTP - 打卡第四天 | 2019-07-13 | 第七章、第八章、第九章 |

# 图解 HTTP

# Chapter - 7

这一章主要讲的是 HTTPS

<!-- more -->



## HTTPS

HTTP 通信接口部分用 SSL 和 TLS 协议来代替。

通常，HTTP 直接和 TCP 通信。当使用 SSL 时，则演变成先和 SSL 通信，再由 SSL 和 TCP 通信了。换言之，所谓 HTTPS ，就是身披 SSL 协议这层外壳的 HTTP。

![HTTP 和 HTTPS](https://s2.ax1x.com/2019/07/12/ZffxIK.png)

### HTTPS 使用混合加密机制

在交换密钥环节使用公开秘钥加密方式，之后的建立通信交换报文阶段则使用共享秘钥加密方式。

但是怎么保证公开密钥本身就是货真价实的公开密钥呢？

这个时候就需要使用由数字证书认证机构（CA）和其相关机关颁发的公开密钥证书。



### HTTPS 的安全通信机制

![HTTPS 通信](https://s2.ax1x.com/2019/07/12/Zf7ImQ.png)

1. 客户端通过发送 Client Hello 报文开始 SSL 通信。报文中包含客户端支持的 SSL 的指定版本、加密组件列表。
2. 和客户端一样，在报文中包含 SSL 版本以及加密组件。服务器的加密组件内容是从接收到的客户端加密组件内筛选出来的。
3. 发送 Certificate 报文，报文中包含公开密钥证书。
4. 发送 Server Hello Done 报文通知客户端。
5. SSL 第一次握手结束后，客户端以 Client Key Exchange 报文作为回应。报文中包含通信加密中使用的一种被称为 Pre-master secret 的随机密码串。该报文中已用步骤 3 中的公开密钥进行加密。
6. 客户端继续发送 ChangeCipherSpec 报文，提示服务器之后的通信会采用 Pre-master secret 密钥加密。
7. 客户端发送 Finished 报文。
8. 服务器同样发送 Change Cipher Spec 报文。
9. 服务器同样发送 Finished 报文。
10. 两端 Finished 报文交换完毕后，SSL 连接就算建立完成。从此处开始进行应用层协议的通信，即发送 HTTP 请求。
11. 应用层协议通信，即发送 HTTP 响应。
12. 最后由客户端断开连接。断开连接时，发送 close_notify 报文。这步之后再发送 TCP FIN 报文来关闭与 TCP 的通信。

![从仅适用服务器端的公开密钥证书建立 HTTPS 通信的整个过程](https://s2.ax1x.com/2019/07/12/ZfqpJ1.png)

### HTTPS 的优缺点

##### 优点

1. 使用 HTTPS 协议可认证用户和服务器，确保数据发送到正确的客户机和服务器。
2. HTTPS 协议是由 SSL+HTTP 协议构建的可进行加密传输、身份认证的网络协议，要比 http 协议安全，可防止数据在传输过程中不被窃取、改变，确保数据的完整性。
3. HTTPS 是现行架构下最安全的解决方案，虽然不是绝对安全，但它大幅增加了中间人攻击的成本。
4. 相比之下，SEO 更加友好。



##### 缺点

1. HTTPS 协议握手阶段比较好时，会使页面的加载时间延长近 50% ，增加 10% 到 20% 耗电。
2. HTTPS 连接缓存不如 HTTP 高效，会增加数据开销和功耗，甚至已有的安全措施也会因此而受到影响。
3. SSL 证书要钱，而且证书通常需要绑定 IP，不能在同一 IP 上绑定多个域名，IPv4 资源不可能支撑这个消耗。



# Chapter - 8

这一章主要讲的是用户身份认证。

HTTP 使用的认证方式如下所示：

- BASIC 认证（基本认证）
- DIGEST 认证（摘要认证）
- SSL 客户端认证
- FormBase 认证（基于表单认证）



# Chapter - 9

这一章主要讲了 HTTP 新增的功能。

## 消除 HTTP 瓶颈的 SPDY

使用 HTTP 协议探知服务器上内容是否有更新，就必须频繁地从客户端到服务器端进行确认。如果服务器上没有内容更新，那么就会产生徒劳的通信。

若想在现有 Web 实现所需的功能，以下这些 HTTP 标准就会成为瓶颈：

- 一条连接上只可以发送一个请求
- 请求只能从客户端开始。客户端不可以接收除响应外的指令
- 请求 / 响应首部未经压缩就发送。首部信息越多延迟越大
- 发送冗长的首部。每次互相发送相同的首部造成的浪费较多
- 可任意选择数据压缩格式。非强制压缩发送



### Ajax 的解决方法

![Ajax](https://s2.ax1x.com/2019/07/13/Zhhn9U.png)

**利用 Ajax 实时地从服务器获取内容，有可能会导致大量请求产生。另外，Ajax 仍未解决 HTTP 协议本身存在的问题。**



### Comet 的解决方法

一种通过延迟应答，模拟实现服务器端向客户端推送（Server Push）的功能。

通常，服务端接收到请求，在处理完毕后就会立即返回响应，但为了实现推送功能，Comet 会先将响应置于挂起状态，当服务端内有内容更新时，再返回该响应。因此，服务器端一旦有更新，就可以立即反馈给客户端。

![Comet 通信](https://s2.ax1x.com/2019/07/13/Zh4Naq.png)

内容上虽然可以做到实时更新，但是为了保留响应，一次连接的持续时间也变长了。期间，为了维持连接会消耗更多的资源。另外，Comet 也仍未解决 HTTP 协议本身存在的问题。



### SPDY

没有完全改写 HTTP 协议，而是在 TCP/IP 的应用层和传输层之间通过新加会话层的形式运作。同时，考虑到安全性问题，SPDY 规定通信中使用 SSL 。

![SPDY 的设计](https://s2.ax1x.com/2019/07/13/Zh5d0A.png)

使用 SPDY 后，HTTP 协议额外获得一下功能：

- 多路复用流：通过单一的 TCP 连接，可以无限制处理多个 HTTP 请求。所有请求的处理都在一条 TCP 连接上完成，因此 TCP 的处理效率得到提高。
- 赋予请求优先级：SPDY 不仅可以无限制地并发处理请求，还可以给请求逐个分配优先级顺序。这样主要是为了在发送多个请求时，解决因带宽低而导致响应变慢的问题。
- 压缩 HTTP 首部：压缩 HTTP 请求和响应的首部。这一样一来，通信产生的数据包数量和发送的字节数就更少了。
- 推送功能：支持服务器主动向客户端推送数据的功能。这样，服务器可直接发送数据，而不必等待客户端的请求。
- 服务器提示功能：服务器可以主动提示客户端请求所需的资源。由于在客户端发现资源之前就可以获知资源的存在，因此在资源已缓存等情况下，可以避免发送不必要的请求。



## 使用浏览器进行全双工通信的 WebSocket

由于是建立在 HTTP 基础上的协议，因此连接的发起方仍是客户端，而一旦确立 WebSocket 通信连接，不论服务器还是客户端，任意一方都可直接向对象发送报文。

**成功握手确立 WebSocket 连接之后，通信时不再使用 HTTP 的数据帧，而采用 WebSocket 独立的数据帧。**

![WebSocket 通信](https://s2.ax1x.com/2019/07/13/ZhoSVs.png)



## HTTP 2.0

书中讲的很简略，这一点需要自行参考网上。