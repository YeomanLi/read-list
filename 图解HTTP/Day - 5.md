|         title         |    date    |   tags   |
| :-------------------: | :--------: | :------: |
| 图解HTTP - 打卡第五天 | 2019-07-15 | 第十一章 |

# 图解 HTTP

# Chapter - 11

这一章主要讲的是 Web 的攻击技术。



## 攻击模式

分为两种：主动攻击和被动攻击。

- 主动攻击：SQL 注入等。
- 被动攻击：跨站脚本攻击（XSS）、跨站点请求伪造（CSRF）等。



## 因输出值转义不完全引发的安全漏洞

### XSS 攻击

跨站脚本攻击，是一种 web 应用中的计算机漏洞，当用户浏览器渲染整个 HTML 文档的过程中出现了不被预期的脚本指令并执行时，XSS 就会发生。

它指的是攻击者向 web 页面中插入恶意 HTML 代码，当用户浏览网页时，嵌入其中 web 里面的 HTML 代码就会执行，从而达到恶意攻击用户的特殊目的。

分为三种：

- 反射型：跨站代码一般存在于某一个链接中，当被攻击者访问这样的连接时，跨站代码就会被执行，这类跨站代码一般不会存储在服务器上面。
- 存储型：这种用起来比较方便，跨站代码会存储在服务器上的数据库中，换句话说就是可以持久地进行攻击，亦称持久型。
- 基于 DOM 的 XSS：由于客户端脚本自身的解析不正确导致的安全问题。



#### 示例：

```javascript
<!-- 比如在一个留言板中插入xss代码，前提是留言内容不过滤 -->

<!-- 在文本框中添加 -->
<script>
  alert('我是XSS攻击')
</script>

<!-- 这时候点击留言，脚本被执行，就会弹出对话框，这就说明存在XSS危害 -->
```



#### 预防：

最普遍的做法是转义输入输出的内容，对于引号、尖括号、斜杠进行转义：

```javascript
function escape(str) {
  str = str.replace(/&/g, '&amp;')
  str = str.replace(/</g, '&lt;')
  str = str.replace(/>/g, '&gt;')
  str = str.replace(/"/g, '&quto;')
  str = str.replace(/'/g, '&##39;')
  str = str.replace(/`/g, '&##96;')
  str = str.replace(/\//g, '&##x2F;')
  return str
}

// 通过转义，将攻击代码变成
escape('<script>alert(1)</script>')
// &lt;script&gt;alert(1)&lt;&##x2F;script&gt;
```



### SQL 注入攻击

SQl 注入攻击是指针对 Web 应用使用的数据库，通过运行非法的 SQL 语句而产生的攻击。正常情况下：从 book 表中搜索作者 author = 'Yeoman' 且 flag = 1（书中代表已经出版） 的符合数据，也就是找出 Yeoman 写的已经出版的书的数据。

```http
https://yeoman.space/search?q=Yeoman
```

执行的 SQL 语句为：

```sql
  SELECT * FROM book WHERE author = 'Yeoman' and flag = 1;
```

但是如果通过把查询字段改为：`Yeoman` -> `Yeoman--` ，那么构成的 SQL 语句就变成了这样：

```sql
  SELECT * FROM book WHERE author = 'Yeoman' --' and flag = 1;
```

SQL 语句中的 `--` 之后视为注释，所以，后面的 `and flag = 1` 被忽略了，这就导致该作者未出版的书的条目被暴露出来了。



### OS 命令注入攻击

通过 Web 应用，执行非法的操作系统命令以达到攻击的目的。



### HTTP 首部注入攻击

HTTP 首部注入攻击是值攻击者通过在响应首部字段内插入换行，添加任意响应首部或者主体的一种攻击。属于被动攻击模式。

向首部主体内添加内容的攻击称为 HTTP 响应截断攻击，Web 应用有时会把外部接收到的数值，赋给响应首部字段 `Location` 和 `Set-Cookie`

```
  Location: https://yeoman.space/a.php?q=yeoman
  Set-Cookie: UID=yeoman

  *yeoman 就是插入值
```

HTTP 首部注入攻击有可能会造成以下一些影响

- 设置任何 Cookie 信息
- 重定向至任意 URL
- 显示任意的主体(HTTP 响应截断攻击)



## 因会话管理疏忽引发的安全漏洞

会话管理上有疏忽会导致用户的认证状态被窃取等后果。

### 会话劫持

攻击者通过某种手段拿到了用户的会话 ID ，并非法使用此会话 ID 伪装成用户，达到攻击的目的。

几种攻击者可获得会话 ID 的途径：

- 通过非正规的生成方法推测会话 ID
- 通过窃听或 XSS 攻击盗取会话 ID
- 通过会话固定攻击强行获取会话 ID



### 跨站点请求伪造

跨站点请求伪造（Cross-SIte Request Forgeries，CSRF）攻击是指攻击者通过设置好的陷阱，强制对已完成认证的用户进行非预期的个人信息或设定信息等某些状态更新，属于被动攻击。

跨站点请求伪造有可能会造成以下等影响：

- 利用已通过认证的用户权限更新设定信息等
- 利用已通过认证的用户权限购买商品
- 利用已通过认证的用户权限发表言论

![跨站点请求伪造的攻击案例](https://s2.ax1x.com/2019/07/15/Z7ALW9.png)



## 其他安全攻击

### 点击劫持

点击劫持是值利用透明的按钮或链接做成陷阱，覆盖在 web 页面上，然后诱导用户在不知情的情况下，点击那个链接访问内容的一种攻击手段。这种行为又称为界面伪装（UI Redressing）。



### DoS 攻击

DoS 攻击（Denial of Service attack）是一种让运行中的服务器呈停止状态的攻击。有时也叫做服务停止攻击或拒绝服务攻击。DoS 攻击的对象不仅限于 Web 网站，还包括网络设备及服务器等。

主要有以下两种 DoS 攻击方式：

- 集中利用访问请求造成资源过载，资源用尽的同时，实际上服务也就呈停止状态。
- 通过攻击安全漏洞使服务停止。

其中，集中利用访问请求的DoS 攻击，单纯将就是发送大量的合法请求。服务器很难分辨何为正常请求，因此很难防止 DoS 攻击。

![DoS 攻击](https://s2.ax1x.com/2019/07/15/Z7VCn0.png)

多台计算机发起的 DoS 攻击称为 DDoS 攻击（Distributed Denial of Service attack）。DDoS 攻击通常利用那些感染病毒的计算机作为攻击者的攻击跳板。